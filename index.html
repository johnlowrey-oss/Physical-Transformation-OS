<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Physique Transformation OS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons for UI -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #f8fafc; margin: 0; padding: 0; }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .accent-gradient { background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%); }
        .beast-mode { text-shadow: 0 0 10px rgba(59, 130, 246, 0.5); }
        .hide-scroll::-webkit-scrollbar { display: none; }
        /* Safe area for mobile notch/home bar */
        .pb-safe { padding-bottom: env(safe-area-inset-bottom, 1.5rem); }
    </style>
</head>
<body class="min-h-screen">
    <div id="app"></div>

    <script>
        // --- Configuration ---
        // To use AI features (Motivation/Recipe Gen), enter a Gemini API Key here.
        // Get one for free at: https://aistudio.google.com/
        const GEMINI_API_KEY = ""; 

        // --- Constants from Transformation Plan ---
        const SCHEDULE = {
            Monday: { title: 'Lower Body A', focus: 'Quad Bias', med: 'Goblet Squats + Core' },
            Tuesday: { title: 'Upper Body A', focus: 'Horizontal Push/Pull', med: 'Push-ups + DB Rows' },
            Wednesday: { title: 'Zone 2 Cardio', focus: 'Mitochondrial Health', med: '20min Walk' },
            Thursday: { title: 'Lower Body B', focus: 'Posterior Chain', med: 'RDLs + Core' },
            Friday: { title: 'Upper Body B', focus: 'Hypertrophy Focus', med: 'Incline Press + Curls' },
            Saturday: { title: 'VO2 Max / Family', focus: '4x4 Protocol', med: 'Family Activity' },
            Sunday: { title: 'Rest / Meal Prep', focus: 'Recovery', med: 'Rest' }
        };

        const INITIAL_RECIPES = {
            'Overnight Oats': {
                ingredients: ['1/2 cup Rolled Oats', '1 scoop Whey Protein', '1 tbsp Chia Seeds', '3/4 cup Almond Milk', '1/2 cup Frozen Berries'],
                instructions: 'Mix in jar, refrigerate overnight. 0 prep morning of.'
            },
            'Turkey Chili': {
                ingredients: ['2lbs Lean Ground Turkey', '2 cans Kidney Beans', '1 can Tomatoes', '1 Onion', '2 Bell Peppers', '1 Zucchini'],
                instructions: 'Brown turkey, dump everything in slow cooker. Simmer 30 mins.'
            }
        };

        // --- State Management (LocalStorage) ---
        let activeTab = 'dashboard';
        let userData = JSON.parse(localStorage.getItem('physique_os_data')) || {
            habits: {}, // Format: { "2023-10-25_Monday": true }
            mealPlan: [],
            streak: 0,
            lastCompletedDate: null,
            motivation: "Commit to the 2-Day Rule. One miss is a rest; two is a habit."
        };

        function saveState() {
            localStorage.setItem('physique_os_data', JSON.stringify(userData));
            render();
        }

        // --- Core Logic ---

        function toggleHabit(dayName) {
            const today = new Date().toISOString().split('T')[0];
            const key = `${today}_${dayName}`;
            
            if (userData.habits[key]) {
                delete userData.habits[key];
                userData.streak = Math.max(0, userData.streak - 1);
            } else {
                userData.habits[key] = true;
                userData.streak += 1;
                userData.lastCompletedDate = today;
            }
            saveState();
        }

        async function generateAI(promptType) {
            if (!GEMINI_API_KEY) {
                alert("Please add a Gemini API Key to the code to use AI features.");
                return;
            }

            const prompts = {
                motivation: `Act as a personal performance coach for a 30-year-old 6'3" dad with an "all-or-nothing" personality. Give a 2-sentence piece of aggressive but encouraging motivation based on the goal of becoming a "beast" and sticking to the 2-day rule.`,
                recipe: `Generate a high-protein "Modular Bulk Prep" recipe for a family dinner. High protein (40g+), easy cleanup. Format with Title, Ingredients, and Instructions.`
            };

            const prompt = prompts[promptType];
            
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });
                const result = await response.json();
                const text = result.candidates[0].content.parts[0].text;

                if (promptType === 'motivation') {
                    userData.motivation = text;
                } else {
                    userData.mealPlan.push({ id: Date.now(), text: text });
                }
                saveState();
            } catch (err) {
                console.error("AI Error:", err);
                alert("AI Generation failed. Check console/API key.");
            }
        }

        // --- UI Rendering ---

        function render() {
            const app = document.getElementById('app');
            const todayName = new Intl.DateTimeFormat('en-US', { weekday: 'long' }).format(new Date());
            const todayPlan = SCHEDULE[todayName];

            app.innerHTML = `
                <!-- Header -->
                <header class="p-6 pb-2 border-b border-slate-800 sticky top-0 bg-slate-900/80 backdrop-blur-md z-10">
                    <div class="flex justify-between items-center mb-4">
                        <div>
                            <h1 class="text-2xl font-extrabold beast-mode tracking-tighter">PHYSIQUE <span class="text-blue-500">OS</span></h1>
                            <p class="text-xs text-slate-400 font-semibold uppercase tracking-widest">Year 1: Foundation & Recomp</p>
                        </div>
                        <div class="text-right">
                            <span class="block text-xs text-slate-500 font-bold uppercase tracking-tighter">Streak</span>
                            <span class="text-xl font-extrabold text-orange-500">ðŸ”¥ ${userData.streak} Days</span>
                        </div>
                    </div>
                </header>

                <main class="p-4 space-y-6 pb-32">
                    ${renderTabContent(activeTab, todayPlan, todayName)}
                </main>

                <!-- Navigation Bottom Bar -->
                <nav class="fixed bottom-0 left-0 right-0 glass border-t border-white/5 pb-safe pt-2 px-6 flex justify-between items-center z-20">
                    ${renderNavItem('dashboard', 'layout-dashboard', 'Home')}
                    ${renderNavItem('workouts', 'dumbbell', 'Lift')}
                    ${renderNavItem('meals', 'utensils', 'Eat')}
                    ${renderNavItem('list', 'shopping-cart', 'Shop')}
                </nav>
            `;

            lucide.createIcons();
        }

        function renderNavItem(id, icon, label) {
            const isActive = activeTab === id;
            return `
                <button onclick="switchTab('${id}')" class="flex flex-col items-center p-2 transition-all ${isActive ? 'text-blue-500 scale-110' : 'text-slate-500'}">
                    <i data-lucide="${icon}" class="w-6 h-6 mb-1"></i>
                    <span class="text-[10px] font-bold uppercase tracking-widest">${label}</span>
                </button>
            `;
        }

        function renderTabContent(tab, todayPlan, todayName) {
            const today = new Date().toISOString().split('T')[0];
            const isCompleted = userData.habits[`${today}_${todayName}`];

            switch (tab) {
                case 'dashboard':
                    return `
                        <div class="glass rounded-3xl p-6 relative overflow-hidden accent-gradient">
                            <div class="relative z-10">
                                <h2 class="text-sm font-bold uppercase opacity-80 mb-1">Today's Protocol: ${todayName}</h2>
                                <h3 class="text-3xl font-black mb-4">${todayPlan.title}</h3>
                                <div class="flex items-center space-x-2 text-sm font-semibold bg-black/20 w-fit px-3 py-1 rounded-full mb-6">
                                    <span class="w-2 h-2 rounded-full bg-blue-400 animate-pulse"></span>
                                    <span>${todayPlan.focus}</span>
                                </div>
                                <button onclick="toggleHabit('${todayName}')" 
                                    class="w-full ${isCompleted ? 'bg-green-500' : 'bg-white'} ${isCompleted ? 'text-white' : 'text-blue-900'} font-bold py-4 rounded-2xl shadow-xl active:scale-95 transition-all text-lg">
                                    ${isCompleted ? 'âœ“ SESSION COMPLETED' : 'MARK COMPLETE'}
                                </button>
                            </div>
                            <div class="absolute -right-8 -bottom-8 opacity-20">
                                <i data-lucide="shield-check" class="w-48 h-48"></i>
                            </div>
                        </div>

                        <div class="glass rounded-2xl p-6 border-l-4 border-orange-500">
                            <div class="flex justify-between items-start mb-2">
                                <span class="text-xs font-bold text-orange-500 uppercase">Coach Beast AI</span>
                                <button onclick="generateAI('motivation')"><i data-lucide="refresh-cw" class="w-4 h-4 text-slate-500"></i></button>
                            </div>
                            <p class="text-lg italic font-medium leading-tight">"${userData.motivation}"</p>
                        </div>

                        <div class="p-4 bg-red-500/10 border border-red-500/20 rounded-2xl flex items-center justify-between">
                            <div class="pr-4">
                                <h4 class="font-bold text-red-400">Low Energy? Use MED Mode</h4>
                                <p class="text-xs text-slate-400">${todayPlan.med}</p>
                            </div>
                            <i data-lucide="zap" class="text-red-500 w-8 h-8 flex-shrink-0"></i>
                        </div>
                    `;
                case 'workouts':
                    return `
                        <div class="space-y-6">
                            <div class="flex justify-between items-center">
                                <h2 class="text-3xl font-black uppercase tracking-tighter">Training Split</h2>
                                <a href="https://www.hevy.com/" target="_blank" class="bg-blue-600 px-3 py-1 rounded-full text-[10px] font-bold">OPEN HEVY</a>
                            </div>
                            <div class="grid gap-4">
                                ${Object.entries(SCHEDULE).map(([day, plan]) => `
                                    <div class="glass p-5 rounded-2xl border-white/5">
                                        <div class="flex justify-between mb-1">
                                            <span class="text-xs font-bold text-blue-500 uppercase">${day}</span>
                                            <span class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">${plan.focus}</span>
                                        </div>
                                        <h3 class="text-xl font-bold">${plan.title}</h3>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                case 'meals':
                    return `
                        <div class="space-y-6">
                            <h2 class="text-3xl font-black uppercase tracking-tighter">Fueling</h2>
                            <div class="space-y-4">
                                ${Object.entries(INITIAL_RECIPES).map(([name, data]) => `
                                    <div class="glass p-5 rounded-2xl">
                                        <h3 class="text-lg font-bold text-blue-400 mb-2">${name}</h3>
                                        <ul class="text-xs text-slate-400 space-y-1">
                                            ${data.ingredients.map(i => `<li>â€¢ ${i}</li>`).join('')}
                                        </ul>
                                    </div>
                                `).join('')}
                                ${userData.mealPlan.map(m => `
                                    <div class="glass p-5 rounded-2xl border-orange-500/30">
                                        <h3 class="text-xs font-bold text-orange-500 uppercase mb-2">AI Generated</h3>
                                        <div class="text-sm whitespace-pre-wrap">${m.text}</div>
                                    </div>
                                `).join('')}
                                <button onclick="generateAI('recipe')" class="w-full border-2 border-dashed border-slate-700 p-4 rounded-2xl text-slate-500 font-bold hover:text-white hover:border-slate-500 transition-all">
                                    + GENERATE MODULAR DINNER
                                </button>
                            </div>
                        </div>
                    `;
                case 'list':
                    return `
                        <div class="space-y-6">
                            <h2 class="text-3xl font-black uppercase tracking-tighter">Grocery List</h2>
                            <div class="glass p-6 rounded-3xl space-y-4">
                                <h3 class="font-bold text-blue-500 uppercase text-xs tracking-widest">Base Essentials</h3>
                                ${['Lean Ground Turkey', 'Chicken Thighs', 'Rolled Oats', 'Whey Protein', 'Frozen Berries', 'Greek Yogurt', 'Avocados', 'Spinach'].map(item => `
                                    <label class="flex items-center gap-4 p-2">
                                        <input type="checkbox" class="w-6 h-6 rounded bg-slate-800 border-slate-700">
                                        <span class="font-medium">${item}</span>
                                    </label>
                                `).join('')}
                            </div>
                        </div>
                    `;
            }
        }

        window.switchTab = (tab) => {
            activeTab = tab;
            render();
        };

        // Initial Render
        render();
    </script>
</body>
</html>
